serviceMaps:
 serviceName: wcms-connection
 mappings:
 - version: 1.0
   name: connection
   description: Persists connection details in wcms_connection table
   fromTopic: save-wcms-connection
   isTransaction: true
   queryMaps:

    - query: INSERT INTO public.wcms_connection_address_v2(uuid, tenantid, buildingname, roadname, billingaddress, gisnumber, revenueboundary, locationboundary, adminboundary) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?);
      basePath: connections.*.address
      jsonMaps:

       - jsonPath: $.connections.*.address.uuid

       - jsonPath: $.connections.*.address.tenantid

       - jsonPath: $.connections.*.address.buildingName

       - jsonPath: $.connections.*.address.roadName

       - jsonPath: $.connections.*.address.billingAddress

       - jsonPath: $.connections.*.address.gisNumber

       - jsonPath: $.connections.*.address.revenueBoundary

       - jsonPath: $.connections.*.address.locationBoundary

       - jsonPath: $.connections.*.address.adminBoundary


    - query: INSERT INTO public.wcms_connection_v2(uuid, tenantid, type, status, oldconnectionnumber, acknowledgmentnumber, connectionnumber, applicationtype, billingtype, pipesize, sourcetype, numberoftaps, numberofpersons, parentconnection, documents, property, address, meter, owner, additionaldetails, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
      basePath: connections.*
      jsonMaps:

       - jsonPath: $.connections.*.uuid

       - jsonPath: $.connections.*.tenantId

       - jsonPath: $.connections.*.type

       - jsonPath: $.connections.*.status

       - jsonPath: $.connections.*.oldConnectionNumber

       - jsonPath: $.connections.*.acknowledgmentNumber

       - jsonPath: $.connections.*.connectionNumber

       - jsonPath: $.connections.*.applicationType

       - jsonPath: $.connections.*.billingType

       - jsonPath: $.connections.*.pipeSize

       - jsonPath: $.connections.*.sourceType

       - jsonPath: $.connections.*.numberOfTaps

       - jsonPath: $.connections.*.numberOfPersons

       - jsonPath: $.connections.*.parentConnection

       - jsonPath: $.connections.*.documents

       - jsonPath: $.connections.*.property

       - jsonPath: $.connections.*.address

       - jsonPath: $.connections.*.meter

       - jsonPath: $.connections.*.owner

       - jsonPath: $.connections.*.additionalDetails
         type: JSON
         dbType: JSONB

       - jsonPath: $.connections.*.auditDetails.createdBy

       - jsonPath: $.connections.*.auditDetails.createdTime

       - jsonPath: $.connections.*.auditDetails.lastModifiedBy

       - jsonPath: $.connections.*.auditDetails.lastModifiedTime
       
       
       
       
 - version: 1.0
   name: connection
   description: Update connection details in wcms_connection table
   fromTopic: update-wcms-connection
   isTransaction: true
   queryMaps:

    - query: UPDATE public.wcms_connection_address_v2 SET buildingname=?, roadname=?, billingaddress=?, gisnumber=?, revenueboundary=?, locationboundary=?, adminboundary=? WHERE tenantid=?, uuid=?;
      basePath: connections.*.address
      jsonMaps:

       - jsonPath: $.connections.*.address.buildingName

       - jsonPath: $.connections.*.address.roadName

       - jsonPath: $.connections.*.address.billingAddress

       - jsonPath: $.connections.*.address.gisNumber

       - jsonPath: $.connections.*.address.revenueBoundary

       - jsonPath: $.connections.*.address.locationBoundary

       - jsonPath: $.connections.*.address.adminBoundary

    - query: INSERT INTO public.wcms_connection_v2(uuid, tenantid, type, status, oldconnectionnumber, acknowledgmentnumber, connectionnumber, applicationtype, billingtype, pipesize, sourcetype, numberoftaps, numberofpersons, parentconnection, documents, property, address, meter, owner, additionaldetails, lastmodifiedby, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
      basePath: connections.*
      jsonMaps:

       - jsonPath: $.connections.*.uuid

       - jsonPath: $.connections.*.tenantId

       - jsonPath: $.connections.*.type

       - jsonPath: $.connections.*.status

       - jsonPath: $.connections.*.oldConnectionNumber

       - jsonPath: $.connections.*.acknowledgmentNumber

       - jsonPath: $.connections.*.connectionNumber

       - jsonPath: $.connections.*.applicationType

       - jsonPath: $.connections.*.billingType

       - jsonPath: $.connections.*.pipeSize

       - jsonPath: $.connections.*.sourceType

       - jsonPath: $.connections.*.numberOfTaps

       - jsonPath: $.connections.*.numberOfPersons

       - jsonPath: $.connections.*.parentConnection

       - jsonPath: $.connections.*.documents

       - jsonPath: $.connections.*.property

       - jsonPath: $.connections.*.address

       - jsonPath: $.connections.*.meter

       - jsonPath: $.connections.*.owner

       - jsonPath: $.connections.*.additionalDetails
         type: JSON
         dbType: JSONB

       - jsonPath: $.connections.*.auditDetails.lastModifiedBy

       - jsonPath: $.connections.*.auditDetails.lastModifiedTime
